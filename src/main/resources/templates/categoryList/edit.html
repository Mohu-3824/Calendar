<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <div th:replace="~{fragment :: meta}"></div>
    <div th:replace="~{fragment :: styles}"></div>
    <title>カテゴリー編集</title>
</head>
<body>
<div class="edelweiss-wrapper">
    <div th:replace="~{fragment :: header}"></div>

    <main class="container pt-4 pb-5 edelweiss-container">
        <h3 class="title mb-4" th:text="${isEdit} ? 'カテゴリー編集' : 'カテゴリー新規作成'"></h3>

        <form th:action="${isEdit} ? @{'/categories/update/' + ${categoryId}} : @{/categories/save}"
              th:object="${categoryForm}"
              method="post" class="row g-3">

            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

            <!-- カテゴリー名 -->
            <div class="col-12">
                <label class="form-label">カテゴリー名</label>
                <input type="text" th:field="*{categoryName}" class="form-control" placeholder="例) 運動"/>
                <div class="text-danger small" th:errors="*{categoryName}"></div>
            </div>

            <!-- アイコン選択 -->
            <div class="col-12">
                <label class="form-label">アイコン</label>
                <div class="d-flex flex-wrap gap-2">
                    <div th:each="icon : ${iconList}"
                         class="icon-item p-2 border"
                         style="width:60px; height:60px; cursor:pointer; text-align:center;"
                         th:attr="data-icon=${icon}">
                        <img th:src="@{'/img/' + ${icon}}" alt="icon"
                             style="width:40px; height:40px;" />
                    </div>
                </div>
                <!-- hidden に保存 -->
                <input type="hidden" th:field="*{iconImage}" id="iconImage" />
            </div>

            <!-- カラー選択 -->
            <div class="col-12">
                <label class="form-label">カラー</label>
                <div class="d-flex flex-wrap gap-2">
                    <div th:each="color : ${colorList}"
     					class="color-swatch"
     					th:attr="data-color=${color}"
     					th:style="'background-color:' + ${color} + '; width:40px; height:40px; border:2px solid #ddd; cursor:pointer;'">
					</div>
                </div>
                <input type="hidden" th:field="*{colorCode}" id="colorCode" />
            </div>

            <!-- ボタン -->
            <div class="col-12 mt-3 text-center">
                <button type="submit" class="btn btn-primary" th:text="${isEdit} ? '更新' : '登録'"></button>
                <a th:href="@{/categoryList}" class="btn btn-outline-secondary ms-2">戻る</a>
            </div>
        </form>
    </main>

    <div th:replace="~{fragment :: footer}"></div>
    <div th:replace="~{fragment :: scripts}"></div>
</div>
<script>
window.addEventListener("DOMContentLoaded", function() {
    // アイコン選択
    document.querySelectorAll(".icon-item").forEach(item => {
        item.addEventListener("click", function() {
            document.getElementById("iconImage").value = this.getAttribute("data-icon");
            document.querySelectorAll(".icon-item").forEach(el => el.classList.remove("selected"));
            this.classList.add("selected");
        });
    });

    // カラー選択
    document.querySelectorAll(".color-swatch").forEach(swatch => {
        swatch.addEventListener("click", function() {
            document.getElementById("colorCode").value = this.getAttribute("data-color");
            document.querySelectorAll(".color-swatch").forEach(el => el.classList.remove("selected"));
            this.classList.add("selected");
        });
    });
});
</script>
</body>
</html>