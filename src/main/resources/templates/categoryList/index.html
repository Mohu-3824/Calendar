<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
	<head>
    	<div th:replace="~{fragment :: meta}"></div>
		<div th:replace="~{fragment :: styles}"></div>

    	<title>カテゴリー一覧</title>
	</head>
	<body>
		<div class="edelweiss-wrapper">
		<div th:replace="~{fragment :: header}"></div>

    <main>
        <h2 class="page-title">カテゴリー一覧</h2>

        <!-- カテゴリーテーブル -->
        <table class="category-table">
            <thead>
                <tr>
                    <th></th>
                    <th>カテゴリー名</th>
                    <th>アイコン</th>
                    <th>色</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="category : ${categoryList}">
                    <td><input type="checkbox" th:value="${category.id}"></td>
                    <td th:text="${category.categoryName}"></td>
                    <td><img th:src="@{/img/{file}(file=${category.iconImage})}" alt="アイコン" style="width:30px; height:40px;" /></td>
                    <td>
                        <span class="color-box" th:style="'background-color:' + ${category.colorCode}"></span>
                    </td>
                    <td>
                		<!-- 編集ボタン（別画面予定ならリンクにする） -->
                		<a th:href="@{'/categories/edit/' + ${category.id}}" 
                   			class="btn btn-sm btn-edit btn-primary">編集</a>

                		<!-- 削除ボタン（フォーム方式で確実に動作） -->
                		<form th:action="@{'/categories/delete/' + ${category.id}}" 
                      		method="post" style="display:inline;">
                    		<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    		<button type="submit" 
                            	class="btn btn-sm btn-danger btn-delete"
                           		onclick="return confirm('本当にこのカテゴリーを削除しますか？');">
                        		削除
                   			</button>
               	 		</form>
                    </td>
                </tr>
            </tbody>
        </table>
        <!-- フラッシュメッセージを埋め込み -->
		<div id="flash-success" th:if="${successMessage}" th:text="${successMessage}" style="display:none;"></div>
		<div id="flash-error" th:if="${errorMessage}" th:text="${errorMessage}" style="display:none;"></div>

        <!-- 戻るボタン -->
        <div class="center-btn">
            <a th:href="@{/calendar}" class="btn btn-outline-secondary ms-2">カレンダーへ戻る</a>
        </div>
        <!-- 右下の＋ボタン -->
    	<a th:href="@{/categories/new}" class="fab-btn" title="追加">
    		<i class="fas fa-plus"></i>
		</a>
    </main>
        	<div th:replace="~{fragment :: footer}"></div>
        </div>
        <div th:replace="~{fragment :: scripts}"></div>
	</body>
</html>     