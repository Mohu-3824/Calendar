<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <div th:replace="~{fragment :: meta}"></div>
    <div th:replace="~{fragment :: styles}"></div>
    <title th:text="${editMode} ? 'タスク編集' : 'タスク新規作成'"></title>
</head>
<body>
<div class="edelweiss-wrapper">
    <div th:replace="~{fragment :: header}"></div>
    <main class="container py-4">

        <!-- 直近のタスク -->
        <h6>直近のタスク</h6>
        <div class="recent-task-list">
            <div th:each="t : ${recentTasks}"
                 th:classappend="'recent-task cat-' + ${t.categoryCode}">
                <span th:text="${t.title}"></span>
                <div class="small">
                    <span th:text="${t.currentStreak + '日連続達成中'}"></span><br>
                    <span th:text="${'累計' + t.maxStreak + '日達成'}"></span>
                </div>
            </div>
        </div>

         <!-- 共通フォーム -->
        <form th:object="${tasks}"
              th:action="@{${editMode} ? '/tasks/update' : '/tasks/new'}"
              method="post">

            <!-- ID（更新時のみ必要） -->
            <input type="hidden" th:if="${editMode}" th:field="*{id}"/>
            <!-- TaskMaster ID -->
            <input type="hidden" th:field="*{task.id}"/>
            <!-- User ID -->
            <input type="hidden" th:field="*{user.id}"/>

            <!-- 日付選択 -->
            <div class="d-flex align-items-center my-3">
                <button type="button" class="btn btn-outline-secondary btn-sm me-2">&lt;</button>
                <input type="date" th:field="*{taskDate}" class="form-control w-auto"/>
                <button type="button" class="btn btn-outline-secondary btn-sm ms-2">&gt;</button>
            </div>

            <!-- タスク名 -->
            <div class="mb-3">
                <label class="form-label">タスク</label>
                <input type="text" th:field="*{task.title}" class="form-control" placeholder="タスク名を入力"/>
            </div>

            <!-- 保存 / 更新ボタン -->
            <div class="mt-4">
                <button type="submit" class="save-btn" th:text="${editMode} ? '更新' : '保存'"></button>
            </div>
        </form>
    </main>

    <div th:replace="~{fragment :: footer}"></div>
</div>

<div th:replace="~{fragment :: scripts}"></div>
</body>
</html>